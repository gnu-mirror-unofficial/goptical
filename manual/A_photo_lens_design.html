<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <meta name="Generator" content="MKDOC " />
 <title>GNU Goptical manual </title>
 <link rel="stylesheet" href="mkdoc.css" />
 <style type="text/css">

  .sec_hidden { display: none; }
  .sec_shown {}
 </style>
</head><body>
<div class="page"><div class="head"><div class="headlinks"><a href="Table_of_contents.html">Table of contents</a>
 &nbsp; <a href="Introduction.html">Introduction</a>
 &nbsp; <a href="Tutorial.html">Tutorial</a>
 &nbsp; <a href="Main_classes.html">Main classes</a>
</div><div class="navlinks"><a href="index.html" accesskey="t">Top</a> &nbsp; <a href="A_simple_refractor_design.html"  accesskey="p" id="nav_prev">Previous </a> &nbsp; <a href="Tutorial.html"  accesskey="u" id="nav_up"> Up </a> &nbsp; <a href="System_hierarchy_and_groups.html"  accesskey="n" id="nav_next"> Next</a></div>
</div><div class="content"><div style="clear: both; height:20px;"></div>
<h1>3.2 A photo lens design</h1><div class="sec_content1">
<div style="clear: both; height:20px;"></div>
<div class="img_frame"><img src="tessar_layout.png" alt="Tessar lens system 2d layout with chief and marginal rays" /><div class="img_caption">Tessar lens system 2d layout with chief and marginal rays</div>
</div></div><h2>3.2.1 Using the Lens component<a href="#_Using_the_Lens_component" id="_Using_the_Lens_component" class="hover_link">&nbsp;&nbsp;</a></h2><div class="sec_content2">
<p>The <span class="codedecl">Sys::<a href="Sys_Lens_class_reference.html">Lens</a></span> class is a convenient way to model a list of optical surfaces. In this example we use it to model a Tessar photo lens by adding all optical surfaces to the lens object. Several functions are available to add surfaces to the lens; one of the simplest can create spherical surfaces with circular aperture for us. In this example, the glass material models used are created on the fly:</p>
<div class="codebox"><code><span class="codecmt">// code from <a href="http://svn.savannah.gnu.org/viewvc/trunk/goptical/examples/tessar_lens/tessar.cc?annotate=1&root=goptical&revision=1#l70">examples/tessar_lens/tessar.cc:70</a></span><br /><br />  <a class="coderef" href="Sys_Lens_class_reference.html">Sys::Lens</a>     lens(<a class="coderef" href="Math_namespace_reference.html#__656">Math::Vector3</a>(0, 0, 0));<br /><br />  <span class="codecmt">//               roc,            ap.radius, thickness,</span><br /><br />  lens.add_surface(1/0.031186861,  14.934638, 4.627804137,<br />                   <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Material_namespace_reference.html#__520">Material::AbbeVd</a>&gt;::create(1.607170, 59.5002));<br /><br />  lens.add_surface(0,              14.934638, 5.417429465);<br /><br />  lens.add_surface(1/-0.014065441, 12.766446, 3.728230979,<br />                   <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Material_namespace_reference.html#__520">Material::AbbeVd</a>&gt;::create(1.575960, 41.2999));<br /><br />  lens.add_surface(1/0.034678487,  11.918098, 4.417903733);<br /><br />  lens.add_stop   (                12.066273, 2.288913925);<br /><br />  lens.add_surface(0,              12.372318, 1.499288597,<br />                   <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Material_namespace_reference.html#__520">Material::AbbeVd</a>&gt;::create(1.526480, 51.4000));<br /><br />  lens.add_surface(1/0.035104369,  14.642815, 7.996205852,<br />                   <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Material_namespace_reference.html#__520">Material::AbbeVd</a>&gt;::create(1.623770, 56.8998));<br /><br />  lens.add_surface(1/-0.021187519, 14.642815, 85.243965130);<br /><br />  sys.add(lens);<br /></code></div></div><h2>3.2.2 Adding multiple light sources<a href="#_Adding_multiple_light_sources" id="_Adding_multiple_light_sources" class="hover_link">&nbsp;&nbsp;</a></h2><div class="sec_content2">
<p>The <span class="codedecl">Sys::<a href="Sys_SourcePoint_class_reference.html">SourcePoint</a></span> class can be used to create a point light source suitable for analysis, but we sometimes want to trace custom rays. This can be achieved by using the <span class="codedecl">Sys::<a href="Sys_SourceRays_class_reference.html">SourceRays</a></span> component class.</p>
<p>In this example we add both source types to our system but enable a single one at the same time. The <span class="codedecl">Sys::<a href="Sys_SourceRays_class_reference.html">SourceRays</a></span> is used to draw a 2d layout with chief and marginal rays whereas the <span class="codedecl">Sys::<a href="Sys_SourcePoint_class_reference.html">SourcePoint</a></span> source is used with multiple wavelengths for ray fan and spot diagram analysis:</p>
<div class="codebox"><code>  <a class="coderef" href="Sys_SourceRays_class_reference.html">Sys::SourceRays</a>  source_rays(<a class="coderef" href="Math_namespace_reference.html#__656">Math::Vector3</a>(0, 27.5, -1000));<br /><br />  <a class="coderef" href="Sys_SourcePoint_class_reference.html">Sys::SourcePoint</a> source_point(<a class="coderef" href="Sys_namespace_reference.html#__1195">Sys::SourceAtFiniteDistance</a>,<br />                                <a class="coderef" href="Math_namespace_reference.html#__656">Math::Vector3</a>(0, 27.5, -1000));<br /><br />  <span class="codecmt">// add sources to system</span><br />  sys.add(source_rays);<br />  sys.add(source_point);<br /><br />  <span class="codecmt">// configure sources</span><br />  source_rays.add_chief_rays(sys);<br />  source_rays.add_marginal_rays(sys, 14);<br /><br />  source_point.clear_spectrum();<br />  source_point.add_spectral_line(<a class="coderef" href="Light_SpectralLine_class_reference.html#__499">Light::SpectralLine::C</a>);<br />  source_point.add_spectral_line(<a class="coderef" href="Light_SpectralLine_class_reference.html#__506">Light::SpectralLine::e</a>);<br />  source_point.add_spectral_line(<a class="coderef" href="Light_SpectralLine_class_reference.html#__502">Light::SpectralLine::F</a>);<br /></code></div><p> The object is located at -1000 on the Z axis and has a height of 27.5.</p>
</div><h2>3.2.3 Plotting spot diagram<a href="#_Plotting_spot_diagram" id="_Plotting_spot_diagram" class="hover_link">&nbsp;&nbsp;</a></h2><div class="sec_content2">
<p>The <span class="codedecl">Analysis::<a href="Analysis_Spot_class_reference.html">Spot</a></span> class can be used to plot spot diagrams:</p>
<div class="codebox"><code>    sys.enable_single&lt;<a class="coderef" href="Sys_Source_class_reference.html">Sys::Source</a>&gt;(source_point);<br /><br />    sys.get_tracer_params().set_default_distribution(<br />      <a class="coderef" href="Trace_Distribution_class_reference.html">Trace::Distribution</a>(<a class="coderef" href="Trace_namespace_reference.html#__1357">Trace::HexaPolarDist</a>, 12));<br /><br />    <a class="coderef" href="Analysis_Spot_class_reference.html">Analysis::Spot</a> spot(sys);<br /><br />      <a class="coderef" href="Io_RendererSvg_class_reference.html">Io::RendererSvg</a> renderer(<span class="codestr">&quot;spot.svg&quot;</span>, 300, 300, <a class="coderef" href="Io_namespace_reference.html#__347">Io::rgb_black</a>);<br /><br />      spot.draw_diagram(renderer);<br /></code></div><div class="img_frame"><img src="tessar_spot.png" alt="Tessar lens spot diagram" /><div class="img_caption">Tessar lens spot diagram</div>
</div><div class="codebox"><code>      <a class="coderef" href="Io_RendererSvg_class_reference.html">Io::RendererSvg</a> renderer(<span class="codestr">&quot;spot_intensity.svg&quot;</span>, 640, 480);<br /><br />      <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Data_Plot_class_reference.html">Data::Plot</a>&gt; plot = spot.get_encircled_intensity_plot(50);<br /><br />      plot-&gt;draw(renderer);<br /></code></div><div class="img_frame"><img src="tessar_spot_intensity.png" /></div></div><h2>3.2.4 Plotting ray fans<a href="#_Plotting_ray_fans" id="_Plotting_ray_fans" class="hover_link">&nbsp;&nbsp;</a></h2><div class="sec_content2">
<p>Various ray fan plots can be obtained by using the <span class="codedecl">Analysis::<a href="Analysis_RayFan_class_reference.html">RayFan</a></span> class:</p>
<div class="codebox"><code>    sys.enable_single&lt;<a class="coderef" href="Sys_Source_class_reference.html">Sys::Source</a>&gt;(source_point);<br /><br />    <a class="coderef" href="Analysis_RayFan_class_reference.html">Analysis::RayFan</a> fan(sys);<br /><br />      <a class="coderef" href="Io_RendererSvg_class_reference.html">Io::RendererSvg</a> renderer(<span class="codestr">&quot;opd_fan.svg&quot;</span>, 640, 480);<br /><br />      <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Data_Plot_class_reference.html">Data::Plot</a>&gt; fan_plot = fan.get_plot(<a class="coderef" href="Analysis_RayFan_class_reference.html#__8">Analysis::RayFan::EntranceHeight</a>,<br />                                              <a class="coderef" href="Analysis_RayFan_class_reference.html#__8">Analysis::RayFan::OpticalPathDiff</a>);<br /><br />      fan_plot-&gt;draw(renderer);<br /><br /></code></div><div class="img_frame"><img src="tessar_opdfan.png" /></div><div class="codebox"><code>      <a class="coderef" href="Io_RendererSvg_class_reference.html">Io::RendererSvg</a> renderer(<span class="codestr">&quot;transverse_fan.svg&quot;</span>, 640, 480);<br /><br />      <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Data_Plot_class_reference.html">Data::Plot</a>&gt; fan_plot = fan.get_plot(<a class="coderef" href="Analysis_RayFan_class_reference.html#__8">Analysis::RayFan::EntranceHeight</a>,<br />                                              <a class="coderef" href="Analysis_RayFan_class_reference.html#__8">Analysis::RayFan::TransverseDistance</a>);<br /><br />      fan_plot-&gt;draw(renderer);<br /><br /></code></div><div class="img_frame"><img src="tessar_transverse.png" /></div><div class="codebox"><code>      <a class="coderef" href="Io_RendererSvg_class_reference.html">Io::RendererSvg</a> renderer(<span class="codestr">&quot;longitudinal_fan.svg&quot;</span>, 640, 480);<br /><br />      <a class="coderef" href="http://diaxen.ssji.net/dpp/dpp_ref_class_reference.html">ref</a>&lt;<a class="coderef" href="Data_Plot_class_reference.html">Data::Plot</a>&gt; fan_plot = fan.get_plot(<a class="coderef" href="Analysis_RayFan_class_reference.html#__8">Analysis::RayFan::EntranceHeight</a>,<br />                                              <a class="coderef" href="Analysis_RayFan_class_reference.html#__8">Analysis::RayFan::LongitudinalDistance</a>);<br /><br />      fan_plot-&gt;draw(renderer);<br /><br /></code></div><div class="img_frame"><img src="tessar_longitudinal.png" /></div></div></div></div><div class="foot"><p class="generated"><a style="float: right;" href="http://validator.w3.org/check?uri=referer">Valid XHTML 1.0 Strict</a>Generated by diaxen on Thu Oct  6 00:35:05 2011 using <a href="http://www.nongnu.org/mkdoc/">MkDoc</a></p></div></body></html>