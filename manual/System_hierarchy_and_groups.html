<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <meta name="Generator" content="MKDOC " />
 <title>GNU Goptical manual </title>
 <link rel="stylesheet" href="mkdoc.css" />
 <style type="text/css">

  .sec_hidden { display: none; }
  .sec_shown {}
 </style>
</head><body>
<div class="page"><div class="head"><div class="headlinks"><a href="Table_of_contents.html">Table of contents</a>
 &nbsp; <a href="Introduction.html">Introduction</a>
 &nbsp; <a href="Tutorial.html">Tutorial</a>
 &nbsp; <a href="Main_classes.html">Main classes</a>
</div><div class="navlinks"><a href="index.html" accesskey="t">Top</a> &nbsp; <a href="A_photo_lens_design.html"  accesskey="p" id="nav_prev">Previous </a> &nbsp; <a href="Tutorial.html"  accesskey="u" id="nav_up"> Up </a> &nbsp; <a href="A_parameterizable_segmented_mirror_model.html"  accesskey="n" id="nav_next"> Next</a></div>
</div><div class="content"><div style="clear: both; height:20px;"></div>
<h1>3.3 System hierarchy and groups</h1><div class="sec_content1">
<div style="clear: both; height:20px;"></div>
<p>Goptical allows arranging components of the optical system in a hierarchical manner. Optical component classes all inherit from the <span class="codedecl">Sys::<a href="Sys_Element_class_reference.html">Element</a></span> class. Elements which inherit from the <span class="codedecl">Sys::<a href="Sys_Group_class_reference.html">Group</a></span> class can contain nested elements.</p>
<p>Each element has a local coordinate system and store a <span class="codedecl">Math::<a href="Math_Transform_3_class_reference.html">Transform</a>&lt;3&gt;</span> object which describes its translation and rotation relative to parent coordinates system.</p>
</div><h2>3.3.1 The Lens component<a href="#_The_Lens_component" id="_The_Lens_component" class="hover_link">&nbsp;&nbsp;</a></h2><div class="sec_content2">
<p>The <span class="codedecl">Sys::<a href="Sys_Lens_class_reference.html">Lens</a></span> optical component is a good example of group component. It is based on the <span class="codedecl">Sys::<a href="Sys_Group_class_reference.html">Group</a></span> class so that it can embed <span class="codedecl">Sys::<a href="Sys_OpticalSurface_class_reference.html">OpticalSurface</a></span> and <span class="codedecl">Sys::<a href="Sys_Stop_class_reference.html">Stop</a></span> elements.</p>
<p>When displaying system and raytrace sequence of the <a href="A_photo_lens_design.html">tessar lens design described in the previous section</a>, we notice that the system hierarchy has been flattened in the sequence:</p>
<div class="codebox"><code>system:<br />   [1]Goptical::Sys::Lens at [0, 0, 0]<br />   [10]Goptical::Sys::Image at [0, 0, 125.596]<br />   [11]Goptical::Sys::SourceRays at [0, 27.5, -1000]<br />   [12]Goptical::Sys::SourcePoint at [0, 27.5, -1000]<br />sequence:<br />   [11]Goptical::Sys::SourceRays at [0, 27.5, -1000]<br />   [12]Goptical::Sys::SourcePoint at [0, 27.5, -1000]<br />   [2]Goptical::Sys::OpticalSurface at [0, 0, 0]<br />   [3]Goptical::Sys::OpticalSurface at [0, 0, 4.6278]<br />   [4]Goptical::Sys::OpticalSurface at [0, 0, 10.0452]<br />   [5]Goptical::Sys::OpticalSurface at [0, 0, 13.7735]<br />   [6]Goptical::Sys::Stop at [0, 0, 18.1914]<br />   [7]Goptical::Sys::OpticalSurface at [0, 0, 20.4803]<br />   [8]Goptical::Sys::OpticalSurface at [0, 0, 21.9796]<br />   [9]Goptical::Sys::OpticalSurface at [0, 0, 29.9758]<br />   [10]Goptical::Sys::Image at [0, 0, 125.596]</code></div><p>Positions of optical surfaces are relative to the parent lens position.</p>
</div><h2>3.3.2 A Newton telescope with corrector<a href="#_A_Newton_telescope_with_corrector" id="_A_Newton_telescope_with_corrector" class="hover_link">&nbsp;&nbsp;</a></h2><div class="sec_content2">
<p>Object oriented programming together with hierarchical optical components organization in Goptical allow writing complex and dynamically parameterized optical component models composed of simple components.</p>
</div><h3>Using the telescope model<a href="#_Using_the_telescope_model" id="_Using_the_telescope_model" class="hover_link">&nbsp;&nbsp;</a></h3><div class="sec_content3">
<p>Usage of the newton telescope model class is presented here as an example of parameterized models which contain simple components. The following example shows how to build an optical design composed of a light source, the newton telescope model, a corrector lens assembly and an image plane.</p>
<p>The model constructor is called with basic newton telescope parameters and the model internally compute other parameters of the telescope and instantiate internal optical components as needed.</p>
<div class="codebox"><code><span class="codecmt">// code from <a href="http://svn.savannah.gnu.org/viewvc/trunk/goptical/examples/hierarchical_design/newton.cc?annotate=1&root=goptical&revision=1#l61">examples/hierarchical_design/newton.cc:61</a></span><br /><br />  <a class="coderef" href="Sys_System_class_reference.html">Sys::System</a>             sys;<br /><br />  <span class="codecmt">// light source</span><br />  <a class="coderef" href="Sys_SourcePoint_class_reference.html">Sys::SourcePoint</a>        source(<a class="coderef" href="Sys_namespace_reference.html#__1195">Sys::SourceAtInfinity</a>, <a class="coderef" href="Math_namespace_reference.html#__683">Math::vector3_001</a>);<br />  sys.add(source);<br /><br />  <span class="codecmt">// Newton telescope</span><br />  <a class="coderef" href="Design_Telescope_Newton_class_reference.html">Design::Telescope::Newton</a> newton(<a class="coderef" href="Math_namespace_reference.html#__682">Math::vector3_0</a>, <span class="codecmt">// position</span><br />                                   1494.567 / 2.,   <span class="codecmt">// focal len</span><br />                                   245.1);          <span class="codecmt">// aperture diameter</span><br />  sys.add(newton);<br /></code></div><p> We can query the telescope model to get the 3d position of the focal plane within parent coordinates. This enables to attach the image plane or next optical component at right location without much calculation.</p>
</div><h3>Adding a corrector<a href="#_Adding_a_corrector" id="_Adding_a_corrector" class="hover_link">&nbsp;&nbsp;</a></h3><div class="sec_content3">
<p>We choose to attach a Wynne 4 lens corrector to the telescope. As usual we describe the corrector lens group using the <span class="codedecl">Sys::<a href="Sys_Lens_class_reference.html">Lens</a></span> component:</p>
<div class="codebox"><code><br />  <span class="codecmt">// Wynne 4 lens corrector for parabolic mirrors</span><br />  <a class="coderef" href="Sys_Lens_class_reference.html">Sys::Lens</a>               wynne(newton.get_focal_plane(),<br />                                -48.4585);        <span class="codecmt">// z offset of first surface</span><br /><br />                <span class="codecmt">//  roc       ap.radius  thickness  material</span><br />  wynne.add_surface(21.496,   23.2 / 2., 1.905,     bk7);<br />  wynne.add_surface(24.787,   22.5 / 2., 1.574         );<br />  wynne.add_surface(55.890,   22.5 / 2., 1.270,     bk7);<br />  wynne.add_surface(45.164,   21.8 / 2., 18.504        );<br />  wynne.add_surface(29.410,   14.7 / 2., 0.45,      bk7);<br />  wynne.add_surface(13.870,   14.1 / 2., 16.086        );<br />  wynne.add_surface(23.617,   13.1 / 2., 1.805,     bk7);<br />  wynne.add_surface(0,        12.8 / 2., 9.003);<br /><br />  sys.add(wynne);<br /><br />  <span class="codecmt">// image plane</span><br />  <a class="coderef" href="Sys_Image_class_reference.html">Sys::Image</a>              image(wynne.get_exit_plane(), 15);<br />  sys.add(image);<br /><br /></code></div><p> The first surface of the corrector is located relative to origin of the <span class="tt">wynne</span> lens component with a Z offset of -48.4585 in the lens coordinates system but the whole lens is rotated and positioned at the telescope focal plane in the parent coordinates system.</p>
<p>Finally an image plane is created and positioned according to corrector position and last surface thickness.</p>
</div><h3>Querying model and rendering layouts<a href="#_Querying_model_and_rendering_layouts" id="_Querying_model_and_rendering_layouts" class="hover_link">&nbsp;&nbsp;</a></h3><div class="sec_content3">
<p>Model class may also provide access to some internal construction details:</p>
<div class="codebox"><code>  std::cout &lt;&lt; <span class="codestr">&quot;unvignetted image diameter: &quot;</span><br />            &lt;&lt; newton.get_unvignetted_image_diameter() &lt;&lt; std::endl;<br /><br />  std::cout &lt;&lt; <span class="codestr">&quot;secondary minor axis size: &quot;</span><br />            &lt;&lt; newton.get_secondary_minor_axis() &lt;&lt; std::endl;<br /><br />  std::cout &lt;&lt; <span class="codestr">&quot;secondary offset: &quot;</span><br />            &lt;&lt; newton.get_secondary_offset() &lt;&lt; std::endl;<br /><br />  std::cout &lt;&lt; <span class="codestr">&quot;field angle: &quot;</span><br />            &lt;&lt; newton.get_field_angle() &lt;&lt; std::endl;<br /></code></div><p> 2d and 3d layout of the whole system or groups can be rendered. The following code uses paging to render two such different views of the system:</p>
<div class="codebox"><code>  <a class="coderef" href="Io_RendererSvg_class_reference.html">Io::RendererSvg</a>       svg_renderer(<span class="codestr">&quot;layout.svg&quot;</span>, 640, 480);<br />  <a class="coderef" href="Io_RendererViewport_class_reference.html">Io::RendererViewport</a>  &amp;renderer = svg_renderer;<br /><br />  <span class="codecmt">// horizontal page layout</span><br />  renderer.set_page_layout(1, 2);<br /><br />  <span class="codecmt">// 3d system layout on 1st sub-page</span><br />  renderer.set_page(0);<br />  renderer.set_perspective();<br /><br />  sys.draw_3d_fit(renderer, 300);<br />  sys.draw_3d(renderer);<br /><br />  tracer.get_trace_result().draw_3d(renderer);<br /><br />  <span class="codecmt">// 2d Wynne corrector layout on 2nd sub-page</span><br />  renderer.set_page(1);<br /><br />  wynne.draw_2d_fit(renderer);<br />  wynne.draw_2d(renderer);<br /><br />  tracer.get_trace_result().draw_2d(renderer, <span class="codekw">false</span>, &amp;wynne);<br /></code></div><div class="img_frame"><img src="newton_wynne4_layout.png" alt="3d layout of the system and 2d layout closeup of the corrector" /><div class="img_caption">3d layout of the system and 2d layout closeup of the corrector</div>
</div></div></div></div><div class="foot"><p class="generated"><a style="float: right;" href="http://validator.w3.org/check?uri=referer">Valid XHTML 1.0 Strict</a>Generated by diaxen on Sun Sep 11 20:21:28 2011 using <a href="http://www.nongnu.org/mkdoc/">MkDoc</a></p></div></body></html>